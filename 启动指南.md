# TrendRadar 项目启动指南

## 📋 项目简介

TrendRadar 是一个热点新闻聚合工具，可以：
- 自动爬取 11+ 个平台的热点新闻（知乎、微博、抖音、B站等）
- 根据关键词智能筛选
- 多渠道推送通知（企业微信、飞书、钉钉、Telegram、邮件等）
- AI 智能分析（基于 MCP 协议）

---

## 🚀 启动方式

### 方式一：GitHub Actions 自动运行（推荐，云端部署）

**适用场景**：希望自动定时运行，无需本地服务器

**步骤**：

1. **Fork 项目到你的 GitHub**
   - 访问：https://github.com/sansan0/TrendRadar
   - 点击右上角 "Fork" 按钮

2. **配置 GitHub Secrets**
   - 进入你 Fork 的仓库
   - `Settings` → `Secrets and variables` → `Actions` → `New repository secret`
   - 添加你需要的通知平台配置（见下方配置说明）

3. **配置关键词**
   - 编辑 `config/frequency_words.txt`，添加你关心的关键词

4. **配置运行模式**
   - 编辑 `config/config.yaml`，设置 `report.mode`（daily/current/incremental）

5. **手动测试**
   - 进入 `Actions` 标签页
   - 找到 "Hot News Crawler" 工作流
   - 点击 "Run workflow" 手动触发一次

6. **自动运行**
   - 系统会按照 `.github/workflows/crawler.yml` 中的计划自动运行
   - 默认每小时运行一次

---

### 方式二：Docker 部署（本地运行）

**适用场景**：有本地服务器或 VPS，希望完全控制运行环境

**快速启动**：

```bash
# 1. 创建配置目录
mkdir -p config output

# 2. 下载配置文件（或手动创建）
# Windows PowerShell:
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/sansan0/TrendRadar/master/config/config.yaml" -OutFile "config\config.yaml"
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/sansan0/TrendRadar/master/config/frequency_words.txt" -OutFile "config\frequency_words.txt"

# 3. 编辑配置文件，填入你的 webhook 地址

# 4. 运行 Docker 容器
docker run -d --name trend-radar `
  -v ./config:/app/config:ro `
  -v ./output:/app/output `
  -e FEISHU_WEBHOOK_URL="你的飞书webhook" `
  -e CRON_SCHEDULE="*/30 * * * *" `
  -e RUN_MODE="cron" `
  -e IMMEDIATE_RUN="true" `
  wantcat/trendradar:latest
```

**使用 docker-compose（推荐）**：

```bash
# 1. 下载 docker-compose.yml
# 2. 编辑 .env 文件，填入配置
# 3. 启动
docker-compose up -d

# 查看日志
docker logs -f trend-radar

# 手动执行一次
docker exec -it trend-radar python manage.py run
```

---

### 方式三：启动 MCP 服务器（AI 分析功能）

**适用场景**：需要使用 AI 对话分析新闻数据

**Windows 启动步骤**：

1. **首次部署**（如果还没安装依赖）：
   ```cmd
   setup-windows.bat
   ```
   或英文版：
   ```cmd
   setup-windows-en.bat
   ```

2. **启动 HTTP 服务器**：
   ```cmd
   start-http.bat
   ```
   
   服务将在 `http://localhost:3333/mcp` 启动

3. **配置 MCP 客户端**：
   - **Cursor**：在项目根目录创建 `.cursor/mcp.json`
   - **Claude Desktop**：编辑配置文件添加 MCP 服务器
   - 详细配置见 `README-Cherry-Studio.md`

---

### 方式四：本地直接运行（测试用）

**适用场景**：本地测试配置是否正确

**步骤**：

1. **安装依赖**：
   ```cmd
   setup-windows.bat
   ```

2. **配置环境变量**（可选）：
   ```cmd
   set FEISHU_WEBHOOK_URL=你的飞书webhook
   set DINGTALK_WEBHOOK_URL=你的钉钉webhook
   # ... 其他配置
   ```

3. **运行主程序**：
   ```cmd
   uv run python main.py
   ```

---

## ⚙️ 配置说明

### 1. 通知平台配置

#### 企业微信（最简单）
- 在群聊中添加机器人
- 获取 Webhook URL
- 配置到 GitHub Secret: `WEWORK_WEBHOOK_URL`

#### 飞书
- 访问：https://botbuilder.feishu.cn
- 创建机器人指令 → Webhook 触发
- 配置到 GitHub Secret: `FEISHU_WEBHOOK_URL`

#### 钉钉
- 在群聊中添加自定义机器人
- 安全设置：自定义关键词 "热点"
- 配置到 GitHub Secret: `DINGTALK_WEBHOOK_URL`

#### Telegram
- 找 @BotFather 创建机器人
- 获取 Bot Token 和 Chat ID
- 配置到 GitHub Secrets: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`

#### 邮件
- 配置到 GitHub Secrets:
  - `EMAIL_FROM`: 发件人邮箱
  - `EMAIL_PASSWORD`: 邮箱密码或授权码
  - `EMAIL_TO`: 收件人邮箱（多个用逗号分隔）

### 2. 运行模式配置

在 `config/config.yaml` 中设置 `report.mode`：

- **`daily`**：当日汇总模式
  - 每小时推送当日所有匹配新闻
  - 适合：日报总结、全面了解趋势

- **`current`**：当前榜单模式（默认）
  - 每小时推送当前榜单匹配新闻
  - 适合：实时热点追踪

- **`incremental`**：增量监控模式
  - 只在有新内容时才推送
  - 适合：避免重复信息干扰

### 3. 关键词配置

编辑 `config/frequency_words.txt`：

```txt
# 普通关键词
AI
ChatGPT
华为

# 必须词（用 + 开头）
+发布
+新品

# 过滤词（用 ! 开头）
!广告
!培训

# 用空行分隔不同词组
A股
上证
+涨跌
!预测
```

---

## 🔍 常见问题

### Q1: 如何手动测试推送？
- **GitHub Actions**：进入 Actions → Run workflow
- **Docker**：`docker exec -it trend-radar python manage.py run`
- **本地**：直接运行 `python main.py`

### Q2: 配置文件在哪里？
- 主配置：`config/config.yaml`
- 关键词：`config/frequency_words.txt`
- 输出文件：`output/` 目录

### Q3: 如何查看运行日志？
- **Docker**：`docker logs -f trend-radar`
- **GitHub Actions**：在 Actions 页面查看运行日志
- **本地**：直接在终端查看输出

### Q4: MCP 服务器无法启动？
1. 检查端口 3333 是否被占用
2. 确认已运行 `setup-windows.bat` 安装依赖
3. 查看错误日志

---

## 📚 更多文档

- **完整 README**：`readme.md`
- **MCP 部署教程**：`README-Cherry-Studio.md`
- **MCP 使用 FAQ**：`README-MCP-FAQ.md`

---

## 🎯 快速开始检查清单

- [ ] Fork 项目到 GitHub（或下载到本地）
- [ ] 配置至少一个通知平台（企业微信/飞书/钉钉等）
- [ ] 编辑 `config/frequency_words.txt` 添加关键词
- [ ] 编辑 `config/config.yaml` 选择运行模式
- [ ] 手动测试一次，确认配置正确
- [ ] 等待自动运行（GitHub Actions）或设置定时任务（Docker）

---

**提示**：首次运行后，数据需要 1 小时左右才会更新。如果想立即测试，可以手动触发运行。

